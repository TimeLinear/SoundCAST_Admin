<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="member">

	<select id="selectMembers" resultMap="memberResultMap">
		SELECT
			*
		FROM MEMBER
		LEFT JOIN PROFILE_IMAGE ON MEMBER_PROFILE_IMAGE_NO = PROFILE_IMAGE_NO
		ORDER BY MEMBER_NO DESC
	</select>
	
	<resultMap id="memberResultMap" type="memberExt">
	    <id property="memberNo" column="member_no"/>
	    <result property="memberNickname" column="member_nickname"/>
	    <result property="memberEmail" column="member_email"/>
	    
	    <!-- ProfileImage 객체 매핑 -->
	    <association property="profileImage" javaType="profileImage">
	        <id property="profileImageNo" column="PROFILE_IMAGE_NO"/>
	        <result property="profileImagePath" column="PROFILE_IMAGE_PATH"/>
	    </association>
	</resultMap>
	
	<select id="searchMembers" resultMap="memberResultMap">
		SELECT
			*
		FROM MEMBER
		LEFT JOIN PROFILE_IMAGE ON MEMBER_PROFILE_IMAGE_NO = PROFILE_IMAGE_NO
		<where>
        	<choose>
	            <!-- MEMBER_NO 검색 조건 -->
	            <when test='type == "No" and searchTerm != "defaultSearchTerm"'>
	                MEMBER_NO LIKE '%' || #{searchTerm} || '%'
	            </when>
	            <!-- MEMBER_NICKNAME 검색 조건 -->
	            <when test='type == "닉네임" and searchTerm != "defaultSearchTerm"'>
	                 MEMBER_NICKNAME LIKE '%' || #{searchTerm} || '%'
	            </when>
	            <!-- MEMBER_EMAIL 검색 조건 -->
	            <when test='type == "이메일" and searchTerm != "defaultSearchTerm"'>
	                 MEMBER_EMAIL LIKE '%' || #{searchTerm} || '%'
	            </when>
	            <!-- searchTerm가 빈 문자열인 경우 전체 목록 조회 -->
	            <otherwise>
	                1=1
	            </otherwise>
	        </choose>
	    </where>
		ORDER BY MEMBER_NO DESC
	</select>
	
</mapper>